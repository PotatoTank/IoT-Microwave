# IoT Smart Microwave Backend
This is the backend for the smart microwave at Hack the North 2016.

## Technology
* Flask/SqlAlchemy for API
* Google Cloud Platform
    * Cloud Pub/Sub (psq) for distributed task queue
    * Cloud SQL for database
* YouTube API

## Implementation Overview
### Workers and Task Queue
A distributed task queue will contain all the video IDs ready for processing. It will be initially seeded in some way, either by a random video (or possibly top videos from /r/videos). All videos that are added to the queue will be logged.

Workers will be spun up, and each worker will grab video IDs as they're made available on the queue. If the ID does not already exist in the database, it queries against the YouTube API, to grab all the related videos (``relatedToVideoId``). It then makes another query for the video duration (by setting ``part=contentDetails``), and parses the ISO 8601 string returned. This response is also logged to disk, and then written into the database.

### REST API
The REST API is built using Flask, and essentially takes a GET parameter ``sec``. This will return a JSON object something like:

```js
{
    "type": "YouTube",
    "id": "LKFuXETZUsI"
}
```

In this case, it is the responsibility of the client to build the correct video URL (``https://www.youtube.com/watch?v=LKFuXETZUsI``).

### Database
Database will be generated by SQLAlchemy.

```python
class Video(db.Model):
    __tablename__ = 'videos'

    id = db.Column(db.Integer, primary_key=True)
    type = db.Column(db.String(255))
    url = db.Column(db.String(255))
```

